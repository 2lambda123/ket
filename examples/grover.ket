from ket.lib import pauli_prepare, within
from ket.plugins import make_quantum, diagonal
from math import sqrt, pi

size = 4

@make_quantum
def oracle(x, y):
    def f(x):
        return 1 if x == 3 else 0
    return x, f(x)^y

diag = [0 if i == 0 else pi for i in range(size**2)]

s = quant(size)
h(s)

aux = quant(1)
pauli_prepare(x, aux, -1)

for _ in range(int(sqrt(size))):
    oracle(s, aux)
    within(lambda : h(s), 
           lambda : diagonal(diag, s) )
    
print(measure(s).get())