from ket.lib import pauli_prepare, within
from ket.plugins import make_quantum
from math import sqrt

size = 4

@make_quantum
def oracle(x, y):
    def f(x):
        return 1 if x == 3 else 0
    return x, f(x)^y

s = quant(size)
h(s)

aux = quant(1)
pauli_prepare(x, aux, -1)

for _ in range(int(sqrt(size))):
    oracle(s, aux)
    within(lambda : [h(s), x(s)],
           lambda : ctrl(s[1:], z, s[0]))
    
print(measure(s).get())
