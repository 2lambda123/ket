from ket.lib import pauli_prepare, within, ctrl_int
from math import sqrt, pi

size = 7

def oracle(x, y):
    """f(x) = 1 if x == 3 else 0

    U|x⟩|y⟩ = |x⟩|f(x) ⨁ y⟩
    """
    ctrl_int(x, 3, X, y) 

s = quant(size)
h(s)

aux = quant(1)
pauli_prepare(x, aux, -1)

steps = int((pi/4)*sqrt(2**size))
for _ in range(steps):
    oracle(s, aux)
    within(lambda : [h(s), x(s)],
           lambda : ctrl(s[1:], z, s[0]))
    
print('Exprexted result = 3, measured:', measure(s).get())
