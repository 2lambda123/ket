from ket.lib import pauli_prepare, within, ctrl_int
from math import sqrt

size = 4

def oracle(x, y):
    """f(x) = 1 if x == 3 else 0
    U = |x⟩|f(x) ⨁ y⟩
    """
    ctrl_int(x, 3, X, y) 

s = quant(size)
h(s)

aux = quant(1)
pauli_prepare(x, aux, -1)

for _ in range(int(sqrt(size))):
    oracle(s, aux)
    within(lambda : [h(s), x(s)],
           lambda : ctrl(s[1:], z, s[0]))
    
print(measure(s).get())
