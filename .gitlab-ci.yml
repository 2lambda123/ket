Python_wheel:
  image: quay.io/pypa/manylinux2014_x86_64
  stage: build
  variables:
    GIT_SUBMODULE_STRATEGY: recursive
  script:
    - export PATH=$PATH:/opt/python/cp39-cp39/bin/
    - pip install conan auditwheel
    - python3.7  setup.py bdist_wheel -DCMAKE_C_COMPILER=/opt/rh/devtoolset-10/root/bin/cc -DCMAKE_CXX_COMPILER=/opt/rh/devtoolset-10/root/bin/c++
    - python3.8  setup.py bdist_wheel -DCMAKE_C_COMPILER=/opt/rh/devtoolset-10/root/bin/cc -DCMAKE_CXX_COMPILER=/opt/rh/devtoolset-10/root/bin/c++
    - python3.9  setup.py bdist_wheel -DCMAKE_C_COMPILER=/opt/rh/devtoolset-10/root/bin/cc -DCMAKE_CXX_COMPILER=/opt/rh/devtoolset-10/root/bin/c++
    - python3.10 setup.py bdist_wheel -DCMAKE_C_COMPILER=/opt/rh/devtoolset-10/root/bin/cc -DCMAKE_CXX_COMPILER=/opt/rh/devtoolset-10/root/bin/c++
    - pypy3.7    setup.py bdist_wheel -DCMAKE_C_COMPILER=/opt/rh/devtoolset-10/root/bin/cc -DCMAKE_CXX_COMPILER=/opt/rh/devtoolset-10/root/bin/c++
    - ./wheelrepair.sh
  artifacts:
    paths:
      - wheelhouse
  
AppImage:
  image: ubuntu:20.04
  stage: deploy
  before_script:
    - ln -snf /usr/share/zoneinfo/America/Los_Angeles /etc/localtime
    - apt-get update -y 
    - apt install -y git gtk-update-icon-cache wget python3-pip python3-setuptools patchelf desktop-file-utils libgdk-pixbuf2.0-dev fakeroot strace fuse
    - wget https://github.com/AppImage/AppImageKit/releases/download/continuous/appimagetool-x86_64.AppImage -O /usr/bin/appimagetool.AppImage
    - chmod +x /usr/bin/appimagetool.AppImage
    - /usr/bin/appimagetool.AppImage --appimage-extract
    - mv squashfs-root /usr/bin/appimage.AppDir
    - ln -s /usr/bin/appimage.AppDir/AppRun /usr/bin/appimagetool
    - pip3 install appimage-builder
  script:
    - sed 's/VERSION/"'$(git rev-parse --short HEAD)'"/' AppImageBuilder.yml.in > AppImageBuilder.yml
    - appimage-builder --skip-test
  artifacts:
    paths:
      - ./*.AppImage
  dependencies:
    - Python_wheel

